<div class="p1dv1 col-11 ">






  <ul class="nav nav-fill nav-tabs" role="tablist">
    <li class="nav-item" role="presentation">
      <a class="nav-link active" id="fill-tab-0" data-bs-toggle="tab" href="#fill-tabpanel-0" role="tab"
        aria-controls="fill-tabpanel-0" aria-selected="true" style="font-size: 16px;font-weight: bold;"> Order Summary
      </a>
    </li>
    <li class="nav-item" role="presentation">
      <a class="nav-link" id="fill-tab-1" data-bs-toggle="tab" href="#fill-tabpanel-1" role="tab"
        aria-controls="fill-tabpanel-1" aria-selected="false" style="font-size: 16px;font-weight: bold;"> Order Details
      </a>
    </li>
    <li class="nav-item" role="presentation" *ngIf="getStatus()">
      <a class="nav-link" id="fill-tab-2" data-bs-toggle="tab" href="#fill-tabpanel-2" role="tab" 
        aria-controls="fill-tabpanel-2" aria-selected="false" style="font-size: 16px;font-weight: bold;"> Edit Order </a>
    </li>
    <li class="nav-item" role="presentation" >
      <a class="nav-link" id="fill-tab-3" data-bs-toggle="tab" href="#fill-tabpanel-3" 
        style="font-size: 18px;font-weight: bold;" role="tab" aria-controls="fill-tabpanel-3" aria-selected="false"
        [(ngModel)]="unReadMessages"  [ngStyle]=" this.unReadMessages > 0 ? {'background-color':'yellow'} : {'background-color':'lightgray'}"> Messages  ( {{getNonReadMessages()}}) </a>
    </li>
  </ul>
  <div class="tab-content pt-5" id="tab-content">
    <div class="tab-pane active" id="fill-tabpanel-0" role="tabpanel" aria-labelledby="fill-tab-0">

      <app-order-summery-comman class="mt-3"></app-order-summery-comman>



    </div>
    <div class="tab-pane" id="fill-tabpanel-1" role="tabpanel" aria-labelledby="fill-tab-1">






      <!-- [ordrDt3]="ordrDt" pass input is not workint with mat-paginator-->
      <!--   selector name of the comman component [ordrDt3]="ordrDt" -->
      <app-order-details-comman></app-order-details-comman>







    </div>
    <div class="tab-pane" id="fill-tabpanel-2" role="tabpanel" aria-labelledby="fill-tab-2">



      <!-- Edit order Starts-->


      <div class="row mt-3 "  >
   
        <div class=" col-md-2 col-sm-4">
    
          <div class="form-group " style="background-color: lawngreen;">
            <p style="font-weight: bold;font-size: 20px;margin-left:10px;padding-top:5px;padding-bottom: 5px;"> Agreed </p>
          </div>
        </div>
        <div class=" col-md-2 col-sm-4" >
          <div class="form-group " style="background-color: white;">
            <p style="font-weight: bold;font-size: 20px;margin-left:10px;padding-top:5px;padding-bottom: 5px;"> Available </p>
          </div>
          
        </div>
        <div class="  col-md-2 col-sm-4" >
          <div class="form-group " style="background-color: CornflowerBlue;">
            <p style="font-weight: bold;font-size: 20px;margin-left:10px;padding-top:5px;padding-bottom: 5px;"> Subsitude </p>
          </div>
          
        </div>
        <div class="  col-md-2 col-sm-4" >
          <div class="form-group " style="background-color: orange;">
            <p style="font-weight: bold;font-size: 20px;margin-left:10px;padding-top:5px;padding-bottom: 5px;"> Not Available </p>
          </div>
          
        </div>
        <div class="  col-md-2 col-sm-4">
          <div class="form-group " style="background-color: Yellow;">
            <p style="font-weight: bold;font-size: 20px;margin-left:10px;padding-top:5px;padding-bottom: 5px;"> No Enough quantity </p>
          </div>
        </div>
        <div class="  col-md-2 col-sm-4">
          <div class="form-group " style="background-color: red;">
            <p style="font-weight: bold;font-size: 20px;margin-left:10px;padding-top:5px;padding-bottom: 5px;"> Error </p>
          </div>
        </div>


    
    </div>



      <div  *ngIf="showDiv" >

        <h1 style="font-size: 20px;font-weight: bold;">ORDER TOTAL : {{getTotal()}}</h1>
        <h1 class="mt-3">Original Order Items</h1>

        <table mat-table [dataSource]="stockDetailsList" class="mat-elevation-z8">

          <!--- Note that these columns can be defined in any order.
                      The actual rendered columns are set as a property on the row definition" -->

          <!-- Position Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef> Name </th>
            <td mat-cell *matCellDef="let element"> {{element.productName}} </td>
          </ng-container>

          <!-- Name Column -->
          <ng-container matColumnDef="amount">
            <th mat-header-cell *matHeaderCellDef> Item Price </th>
            <td mat-cell *matCellDef="let element"> {{element.itemPrice}} </td>
          </ng-container>

          <!-- Weight Column -->
          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef> Quantity </th>
            <!--[disabled]="element.itemStatus === 'AVAILABLE'"-->
            <td mat-cell *matCellDef="let element"> <input [(ngModel)]="element.quantity" type="number" id="quantity"
                name="quantity" value="1" min="1" max="5"
                onkeypress="return (event.charCode == 8 || event.charCode == 0 || event.charCode == 13) ? null : event.charCode >= 48 && event.charCode <= 57">
            </td>
          </ng-container>


          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef> status </th>
            <td mat-cell *matCellDef="let element">
              <!--(ngModelChange)='element.itemStatus = onStatusChange($event)  -->
              <select [(ngModel)]="element.itemStatus" (ngModelChange)='onStatusChange( $event , element.itemStatus )'
                name="itemStatus" id="itemStatus">
                <option value="AVAILABLE">Available</option>
                <option value="NOT_AVAILABLE">Not Available</option>
                <option value="NO_ENOUGH_QUANTITY">No Enough Quantity</option>
                <option value="SUBSTITUDE" disabled>Substitude</option>

              </select>

            </td>
          </ng-container>

          <!-- Symbol Column -->
          <ng-container matColumnDef="total">
            <th mat-header-cell *matHeaderCellDef style="text-align: right;"> Total </th>
            <td mat-cell *matCellDef="let element" style="text-align: right;">
              {{calculateRowTotal(element.quantity,element.itemPrice)}} </td>
          </ng-container>


          <!--
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef > Actions </th>
                  <td mat-cell *matCellDef="let element"  > 
                      <button mat-icon-button *ngIf="element.id !== null ? false : true"  [disabled]="element.id !== null ? true : false "  class="btn btn-primary" (click)="removeNewItem(element.productId)" > Remove</button>
                  </td>
              </ng-container>
              -->


          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"
            [style.background-color]=" (row.itemStatus==='NOT_AVAILABLE' ) ? 'orange' : (row.quantity===0) ? 'red' :  (row.itemStatus==='NO_ENOUGH_QUANTITY' ) ? 'yellow' :   (row.itemStatus==='SUBSTITUDE') ? 'CornflowerBlue' : 'none' "
            (click)="highlight(row)"></tr>
        </table>

        <table class="table">
          <thead class="thead">
            <tr>

            </tr>

          </thead>

          <tbody class="tbody">
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td style="text-align: right;font-weight: bold;">Order Total : {{getOrderTotal()}}</td>
            </tr>
          </tbody>



        </table>

        <mat-paginator [pageSizeOptions]="[5,10]" [pageSize]="5" #paginatorOrderItems="matPaginator"
          showFirstLastButtons aria-label="Select page of periodic elements">
        </mat-paginator>


      </div>



      <div class="mt-2">

        <h1 style="background-color: lawngreen;">Add substitude items for the not available items</h1>
        <button class="btn btn-success" type="button" data-toggle="collapse" data-target="#collapseSearch"
          aria-expanded="false" aria-controls="collapseSearch">
          Collapse/Expand Product Search
        </button>

        <div class="collapse  show mt-3" id="collapseSearch">

          <div class="row " style="background-color: white;">
            <div class="col-md-6 col-s-12 mt-2">
              <div class="row">

                <div class="form-group col-6">
                  <label class="inputLable  d-flex justify-content-start align-items-center"
                    for="inputDescription">Company</label>
                  <select id="inputDistrict" placeholder="Main Address" [(ngModel)]="masterTypeId"
                    [ngModelOptions]="{standalone: true}" class="form-control"
                    (ngModelChange)='onMStProductTypeSelected($event)'>
                    <option *ngFor="let mstTypes of masterTypes" [value]="mstTypes.id">
                      {{mstTypes.name}}
                    </option>
                  </select>
                </div>

                <div class="form-group col-6">
                  <label class="inputLable  d-flex justify-content-start align-items-center"
                    for="inputDescription">Brand</label>
                  <select id="inputDistrict" placeholder="Main Address" [(ngModel)]="productTypeId" name="productTypeId"
                    [ngModelOptions]="{standalone: true}" class="form-control">
                    <option *ngFor="let prodType of productTypes" [value]="prodType.id">
                      {{prodType.name}}
                    </option>
                  </select>
                </div>
              </div>

            </div>

            <div class="col-md-6 col-s-12 mt-2">

              <div class="row">

                <div class="form-group col-6">
                  <label class="inputLable  d-flex justify-content-start align-items-center"
                    for="inputDescription">Master Type</label>
                  <select id="inputDistrict" placeholder="Main Address" [(ngModel)]="masterTypeId"
                    [ngModelOptions]="{standalone: true}" class="form-control"
                    (ngModelChange)='onMStProductTypeSelected($event)'>
                    <option *ngFor="let mstTypes of masterTypes" [value]="mstTypes.id">
                      {{mstTypes.name}}
                    </option>
                  </select>
                </div>

                <div class="form-group col-6">
                  <label class="inputLable  d-flex justify-content-start align-items-center"
                    for="inputDescription">Product Type</label>
                  <select id="inputDistrict" placeholder="Main Address" [(ngModel)]="productTypeId" name="productTypeId"
                    [ngModelOptions]="{standalone: true}" class="form-control">
                    <option *ngFor="let prodType of productTypes" [value]="prodType.id">
                      {{prodType.name}}
                    </option>
                  </select>
                </div>
              </div>


            </div>


            <div class="row mb-3">
              <div class=" col-lg-3 col-s-12">
              </div>
              <div class=" col-lg-3 col-s-12"></div>
              <div class=" col-lg-3 col-s-12 d-flex justify-content-end">

              </div>
              <div class=" col-lg-3 col-s-12 d-flex justify-content-end">
                <button class="btn-danger " style="font-size: 20px;" mat-icon-button color="primary" (click)="reset()">
                  Reset
                </button>
                <button class="btn-success ml-3 " style="font-size: 20px;" mat-icon-button color="primary"
                  (click)="search()">
                  Search
                </button>
              </div>
            </div>



          </div>


          <table class="table table-striped table-hover mt-3 ">
            <thead class="thead thead-dark">
              <tr>
                <th scope="col"> Id</th>
                <th scope="col"> Name</th>
                <th scope="col"> Price</th>
                <th scope="col"> Description</th>
                <th scope="col">Status</th>
                <th scope="col" style="text-align: right;">Action</th>
              </tr>

            </thead>

            <tbody class="tbody">
              <tr *ngFor="let prdct of productSlice">

                <td>{{prdct.id}}</td>
                <td>{{prdct.productName}}</td>
                <td>{{prdct.productActualPrice}}</td>
                <td>{{prdct.description}}</td>
                <td>status</td>
                <td style="text-align: right;">
                  <button mat-icon-button class="btn btn-primary btn-sm" (click)="addItem(prdct)"> Add</button>

                </td>

              </tr>
            </tbody>



          </table>


          <mat-paginator class="mt-2 mb-5" [length]="lnght" [pageSize]="4" [pageSizeOptions]="[4,5]"
            (page)="onPageChange($event)" aria-label="Select page">
          </mat-paginator>


        </div>


        <div class="mt-3">

          <table mat-table [dataSource]="interimStockDetailsList" class="mat-elevation-z8">

            <!--- Note that these columns can be defined in any order.
                            The actual rendered columns are set as a property on the row definition" -->

            <!-- Position Column -->
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef> Name </th>
              <td mat-cell *matCellDef="let element"> {{element.productName}} </td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef> Item Price </th>
              <td mat-cell *matCellDef="let element"> {{element.itemPrice}} </td>
            </ng-container>

            <!-- Weight Column -->
            <ng-container matColumnDef="quantity">
              <th mat-header-cell *matHeaderCellDef> Quantity </th>
              <td mat-cell *matCellDef="let element"> <input [(ngModel)]="element.quantity" type="number" id="quantity"
                  name="quantity" value="1" min="1" max="5"
                  onkeypress="return (event.charCode == 8 || event.charCode == 0 || event.charCode == 13) ? null : event.charCode >= 48 && event.charCode <= 57">
              </td>
            </ng-container>


            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef> status </th>
              <td mat-cell *matCellDef="let element">

                <select [(ngModel)]="element.itemStatus" name="interimItemStatus" id="interimItemStatus">
                  <option value="AVAILABLE">Available</option>
                </select>
              </td>
            </ng-container>

            <!-- Symbol Column -->
            <ng-container matColumnDef="total">
              <th mat-header-cell *matHeaderCellDef style="text-align: center;"> Total </th>
              <td mat-cell *matCellDef="let element" style="text-align: center;">
                {{calculateInterimRowTotal(element.quantity,element.itemPrice)}} </td>
            </ng-container>


            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef style="text-align: right;"> Actions </th>
              <td mat-cell *matCellDef="let element" style="text-align: right;">
                <button mat-icon-button *ngIf="element.id !== null ? false : true"
                  [disabled]="element.id !== null ? true : false " class="btn btn-primary"
                  (click)="removeNewItem(element.productId)"> Remove</button>
                  <button mat-icon-button class="btn btn-success btn-sm ml-1 mt-1" *ngIf="element.id !== null ? true : false" (click)="approve(element.id,element)">Approve</button> 
                <button mat-icon-button class="btn btn-danger ml-1 mt-1 btn-sm" *ngIf="element.id !== null ? true : false"
                  (click)="openDialog(element)"> Delete</button>
              </td>
            </ng-container>


            <tr mat-header-row *matHeaderRowDef="displayedColumnsInterim"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumnsInterim;"></tr>
          </table>

          <table class="table">
            <thead class="thead">
              <tr>

              </tr>

            </thead>

            <tbody class="tbody">
              <tr>
                <td></td>
                <td></td>
                <td></td>
                <td style="text-align: right;font-weight: bold;">Order Total : {{getInterimOrderTotal()}}</td>
              </tr>
            </tbody>



          </table>

          <mat-paginator [pageSizeOptions]="[5]" #paginatorInterimOrderItems="matPaginator" showFirstLastButtons
            aria-label="Select page of periodic elements">
          </mat-paginator>


        </div>



        <h1 style="background-color: lawngreen;">Additional charges and Deductions</h1>


        <!-- only aria-expanded="true" is not sufficent 'show' is also mandatory -->
        <div class="mt-3" >


          <div class="row">

            <div class="col-md-6 col-s-12 table-responsive">

              <div class="row">
                <div class="col-md-6 col-s-12">
                  <h1>Additional Charges</h1>
                </div>
                <div class="col-md-6 col-s-12">
                  <button class="btn btn-sm  btn-success ml-3 " style="font-size: 20px;" mat-icon-button color="primary"
                    (click)="addCharge()" style="font-size: 20px; float: right">
                    Add Charge
                  </button>
                </div>

              </div>

              <table class="table table-striped table-hover  overflow-auto">
                <thead class="thead thead-dark">
                  <tr>

                    <th scope="col"> Name</th>
                    <th scope="col"> Amount</th>
                    <th scope="col" style="text-align: right;">Action</th>
                  </tr>


                </thead>

                <tbody class="tbody">
                  <tr *ngFor="let chrg of additionalCharges">


                    <td><input size="50px" type="text" [(ngModel)]="chrg.name" id="nm" name="nm"></td>
                    <td><input min="0" onKeyPress="if(this.value.length==5) return false;" max="999" type="number"
                        [(ngModel)]="chrg.amount" id="amnt" name="amnt"></td>
                    <td style="text-align: right;">
                      <button mat-icon-button class="btn btn-primary btn-sm" *ngIf="chrg.id==null"
                        (click)="removeCharge(chrg)">
                        Remove</button>
                    </td>

                  </tr>
                  <tr>
                    <td></td>
                    <td></td>
                    <td style="text-align: right;font-weight: bold;">Carges Total : {{getChargesTotal()}}</td>
                  </tr>
                </tbody>



              </table>



            </div>


            <div class="col-md-6 col-s-12  table-responsive">

              <div class="row">
                <div class="col-md-6 col-s-12">
                  <h1>Discounts / Deductions</h1>
                </div>
                <div class="col-md-6 col-s-12">
                  <button class=" btn btn-sm  btn-success ml-3 " style="font-size: 20px; float: right" mat-icon-button
                    color="primary" (click)="addDiscount()">
                    Add Discount
                  </button>
                </div>

              </div>

              <table class="table table-striped table-hover">
                <thead class="thead thead-dark">
                  <tr>
                    <th scope="col"> Name</th>
                    <th scope="col"> Amount</th>
                    <th scope="col" style="text-align: right;">Action</th>
                  </tr>

                </thead>

                <tbody class="tbody">
                  <tr *ngFor="let dscnt of deductions">

                    <td><input size="50px" type="text" [(ngModel)]="dscnt.name" id="nm" name="nm"></td>
                    <td><input min="0" onKeyPress="if(this.value.length==5) return false;" max="999" type="number"
                        [(ngModel)]="dscnt.amount" id="amnt" name="amnt"></td>
                    <td style="text-align: right;">
                      <button mat-icon-button class="btn btn-primary btn-sm" *ngIf="dscnt.id==null"
                        (click)="removeDiscount(dscnt)">
                        Remove</button>
                    </td>

                  </tr>

                  <tr>
                    <td></td>
                    <td></td>
                    <td style="text-align: right;font-weight: bold;">Deductions Total : {{getTotalDiscount()}}</td>
                  </tr>


                </tbody>



              </table>


            </div>

          </div>



        </div>



        <div class=" row mt-4">

          <div class="row col-md-6 col-s-12">
            <div class=" col-6 mt-2">
              <button class=" btn btn-sm btn-primary " style="font-size: 20px;" mat-icon-button color="primary" (click)="finalize()">
                Finalize
              </button>

            </div>
            <div class=" col-6 mt-2">

              <button class=" btn btn-sm btn-danger  " style="font-size: 20px;" mat-icon-button color="primary" (click)="cancel()">
                cancel
              </button>

            </div>
          </div>
          <div class="row col-md-6">
            <div class="col-6 mt-2">

              <button class="btn btn-sm  btn-info " style="font-size: 20px;float: right" mat-icon-button color="primary"
                (click)="notify()">
                Notify
              </button>

            </div>
            <div class="col-6 mt-2 ">

              <button class=" btn btn-sm  btn-success " style="font-size: 20px; float: right" mat-icon-button color="primary"
                (click)="save()">
                Save
              </button>

            </div>

          </div>
        </div>





      </div>















      <!-- Edit order ends-->

    </div>




    <div class="tab-pane " id="fill-tabpanel-3" role="tabpanel" aria-labelledby="fill-tab-3">
      <h1 class="mt-2">SEND AND VIEW MESSAGES FROM HERE</h1>

      <div class="row mt-2">

        <div class="form-group  col-md-8 col-sm-12">
          <!--<input type="text"   [(ngModel)]="message" class="form-control" id="description" placeholder="type message">-->
          <textarea class="form-control" placeholder="type the message here" id="w3review" name="w3review"
            maxlength="500" rows="4" [(ngModel)]="message"></textarea>
        </div>

        <div class="form-group col-md-2 col-sm-6 d-flex justify-content-end align-self-center">

          <button class="btn btn-primary btn-sm ml-3 " style="font-size: 20px;" mat-icon-button color="primary"
            (click)="sendMessage()">
            Send Msg
          </button>
        </div>

        <div class="form-group col-md-2 col-sm-6   d-flex justify-content-end align-self-center">

          <button class="btn btn-success  ml-3 " style="font-size: 20px;" mat-icon-button color="success"
            (click)="refresh()">
            Refresh
          </button>
        </div>


      </div>

      <h1 class="mt-3">View Latest 20 Messages</h1>

      <div class="mt-2">

        <div class="container" *ngFor="let m of messageSlice">
          <div class="row mb-3" style="background-color: white;"
            [ngStyle]="{'background-color': (m.readByShop == 'NO') ? 'yellow' : (m.email != 'xyz@gmail.com') ? 'CornflowerBlue' : 'white'}">
            <div class="     col-lg-2 col-md-4 d-flex justify-content-start align-items-center">
              <p style="font-size: 16px;">{{m.createdDate | date:'short'}}</p>
            </div>
            <div class=" col-lg-6 col-md-8 d-flex justify-content-start align-items-center">
              <p style="font-size: 16px;">MESSAGE : {{m.readByShop == 'YES' ? m.message : 'CLICK VIEW BUTTON'}}</p>
            </div>
            <div class=" col-lg-2 col-md-6 d-flex justify-content-end align-items-center">
              <p *ngIf="m.email == 'xyz@gmail.com'" style="font-size: 16px;font-weight: bold;">Read By Customer : {{m.readByCustomer}}</p>
            </div>
            <div class=" col-lg-2 col-md-6 d-flex justify-content-end align-items-center mb-2"> <button
                *ngIf="m.readByShop == 'NO'" class="btn btn-primary mt-2 " (click)="viewMessage(m.id)">
                VIEW</button> <button *ngIf="m.readByShop == 'YES'" class="btn btn-primary mt-2 mr-2 "
                (click)="viewMessagePopup(m.message)"> View</button> <button *ngIf="m.email == 'xyz@gmail.com' && m.id != 0"
                class="btn btn-danger mt-2 "> Delete</button> </div>
          </div>
        </div>

        <mat-paginator class="mt-3 mb-3 " #paginatorMessages="matPaginator" [length]="Msglnght" [pageSize]="5"
          [pageSizeOptions]="[5]" (page)="onPageChange($event)" aria-label="Select page">
        </mat-paginator>

      </div>

    </div>
  </div>




  <!--
  <table mat-table [dataSource]="productDataSource" class="mat-elevation-z8">


      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef> Id. </th>
        <td mat-cell *matCellDef="let element"> {{element.id}} </td>
      </ng-container>
    

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> Name </th>
        <td mat-cell *matCellDef="let element"> {{element.productName}} </td>
      </ng-container>
    
 
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef> Price </th>
        <td mat-cell *matCellDef="let element"> {{element.productActualPrice}} </td>
      </ng-container>
    

      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef> Description </th>
        <td mat-cell *matCellDef="let element"> {{element.description}} </td>
      </ng-container>



      
      <ng-container matColumnDef="edit">
          <th mat-header-cell *matHeaderCellDef> Action </th>
          <td mat-cell *matCellDef="let element"> 
              <button mat-icon-button color="primary" (click)="selectProduct(element.id)"> Select
              </button>
          </td>
      </ng-container>

    
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <mat-paginator

     [pageSizeOptions]="[4,5]"
    showFirstLastButtons
    aria-label="Select page of periodic elements">
  </mat-paginator>
-->






</div>